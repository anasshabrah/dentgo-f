{"version":3,"file":"Login-eHtWjmfv.js","sources":["../../src/assets/images/logo-w.png","../../src/assets/images/Icon-apple.png","../../src/assets/images/Icon-google.png","../../src/assets/images/dentaiBottom.png","../../src/hooks/useGoogleIdentity.ts","../../src/pages/Login.tsx"],"sourcesContent":["export default \"__VITE_ASSET__jAA5oxqk__\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAGXSURBVHgBtVU7UsMwEF3bFEkmk4gbODcwNwgnCJRUOCeAGxBKOtLRJb4BOYHNDWjp3NLJ44bCH55ANorj2GOLvBmNtCvpvdXqR9QTjDF3Op36k8nkuWncGfUASDd5nrvS3DWNNak7+YNhGG5JYJqv9F9AWhjSkhcF5qptTqcVJEniFG2sYs05X7XNsZo6B4OBPR6P6QsQ9mg0Ysj9B9LyBPIX0Y/iwM+LMVUYVYdIQ5Zld4jwXpjSHYJ4m6bpDn4GgYXcB6ZMDeBbQjg8KgBuG0Q+mjb1BIJz4zj2CntvD0C+0SEXsCxrptqlgLg4qOakAaTosbrxpQCiX5AewrpTpabIJg0gwHWdXxVwSE+AtwmcBKpASBrABjunFrgV9+ioAHL4RnoQz4hfFSkFcP0D0octReYHAjjDAaqA9GGrxt4pQh490kcgg/3lrPaKf5Y0ngwEOVNfVLNmwBIVpx6Qb1Go+g4+HPwbfDgcfqJ5Rd3wHkXRTdVZe5MRxRbRXNPf3fj5TFDOQYLKuMBp8WQ/F5GjXNZxfQPDSpauNmJLVwAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAALISURBVHgBrVXNTxNREJ953aIRTCBoABNx5WbEZPmMBw8LeDShAQ94ovwFYDxq0jbKmRr/gJYTECGpB+NBkI16MFqxnjyy8QIi0WJLsG6742xpSbsfpCX8ks2+mffmN++9+XgIx2BTVZqbRMM0IaksyqUPEChNgCkkepE384kOLaV7caCbcktVZJ/PH+OhCrUhXigYETdHDge7I4OTBGaUd9gM9YFPZU61rX1OVCpFpfDzdn/IBIqfgNwC24iAXXl0gp3hgSBLMU9zgjQg6dZOgVDhtc3V0zDftvYp6OrAunPJJ31x3zlpBYRIx2pSq9TuqAMK+WCGCSa9yI8c7I4qMTPrdywgwkjbm49hOAY/RvoC9nuvcnDwCmTJ79/8+74dDt6110VeCwRK/mJgzt7ahsY73wHPFCxy/TTILUg+pNFyrBtu/AKpMwt7z7sicEpAY9X/G6A6IySf0YJDnC0uGJ7NEtSKAkwJOzkj7UVeN5Bk4dDhKZGXIJhQr1QQgUzrcJJKdgIxLRFZ1YlyWbdVOAfPMtc4sz7EXY1Mck0AEjjKqaJULzV1zL2WwnyMkKV4mbsMT7PdkCG/lpxYGYI6MDy7v8lu5CoHhnFVNEj5qCVE97vhSabHIrdEtX9pLFQ7eTZoJ+dU07Vwiy6sjHnwZ3B+6aCr2oowXIsT9XFG5d+cXc8OildZzKK3uYthAJfsYSd9i+Ox/oWAap+6uRCQeQNzRmtiHcDRWXUwDM0aH7Xr3oWxIMfCu10fbiB1SEAyAsrlCZHrhMbtacD8haJsAkxpD5vi1thXXrS18i11afw623k+k2eh9C6jra2TtAf5pg0Q/67w1xpZf3Q+Wp5zPJm9i3dnBFAI4CS1gPeTE8vRSo2jkjd4QZ4KPVxw81A7NI7XkJ286PI4K4UDKUgEBBcRB07B0qnI6lccDzLhKyImkveWNS+O/6WtC73gUBI/AAAAAElFTkSuQmCC\"","export default \"__VITE_ASSET__DZskELDW__\"","import { useEffect } from \"react\";\r\n\r\ntype Callback = () => void;\r\n\r\nexport default function useGoogleIdentity(callback?: Callback): void {\r\n  useEffect(() => {\r\n    const id = \"google-identity-script\";\r\n    if (document.getElementById(id)) {\r\n      callback?.();\r\n      return;\r\n    }\r\n\r\n    const script = document.createElement(\"script\");\r\n    script.id = id;\r\n    script.src = \"https://accounts.google.com/gsi/client\";\r\n    script.async = true;\r\n    script.defer = true;\r\n    script.onload = () => {\r\n      callback?.();\r\n    };\r\n    document.body.appendChild(script);\r\n  }, [callback]);\r\n}","import React, { useEffect, useState, useCallback } from \"react\";\r\nimport { useNavigate, Navigate } from \"react-router-dom\";\r\nimport Loader from \"../components/ui/Loader\";\r\nimport buttonBack from \"../assets/images/Button-Back.png\";\r\nimport logo from \"../assets/images/logo-w.png\";\r\nimport AppleIcon from \"../assets/images/Icon-apple.png\";\r\nimport GoogleIcon from \"../assets/images/Icon-google.png\";\r\nimport dentaiBottom from \"../assets/images/dentaiBottom.png\";\r\n\r\nimport useGoogleIdentity from \"../hooks/useGoogleIdentity\";\r\nimport { useAuth } from \"../context/AuthContext\";\r\nimport { loginWithGoogle as loginWithGoogleAPI, loginWithApple } from \"../api/auth\";\r\n\r\nconst CLIENT_ID = import.meta.env.VITE_GOOGLE_CLIENT_ID;\r\n\r\nconst Login: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const { login, isAuthenticated, initializing, error, setError } = useAuth();\r\n  const [loading, setLoading] = useState(true);\r\n  const [googleReady, setGoogleReady] = useState(false);\r\n\r\n  // 1) Load Google Identity script\r\n  useGoogleIdentity();\r\n\r\n  // 2) If already logged in (once initializing ends), redirect immediately\r\n  useEffect(() => {\r\n    if (!initializing && isAuthenticated) {\r\n      navigate(\"/dentgo-gpt-home\", { replace: true });\r\n    }\r\n  }, [initializing, isAuthenticated, navigate]);\r\n\r\n  // 3) Handle credential response from Google One-Tap\r\n  const handleCredentialResponse = useCallback(\r\n    async (response: any) => {\r\n      const { credential } = response;\r\n      if (!credential) {\r\n        setError(\"No credentials returned. Please try again.\");\r\n        return;\r\n      }\r\n      try {\r\n        // Send credential to backend, get user & cookies set there\r\n        const user = await loginWithGoogleAPI(credential);\r\n        login(user);\r\n        navigate(\"/dentgo-gpt-home\", { replace: true });\r\n      } catch (err: any) {\r\n        console.error(\"Google login error:\", err);\r\n        setError(\r\n          err?.message ||\r\n            \"Authentication failed. Please try again or use a different browser mode.\"\r\n        );\r\n      }\r\n    },\r\n    [login, navigate, setError]\r\n  );\r\n\r\n  // 4) Initialize Google One-Tap once the script is loaded\r\n  useEffect(() => {\r\n    let retryTimeout: number | null = null;\r\n\r\n    const tryInitialize = () => {\r\n      if (window.google?.accounts?.id) {\r\n        if (!CLIENT_ID) {\r\n          console.error(\"Missing VITE_GOOGLE_CLIENT_ID!\");\r\n          alert(\"Google Login misconfigured: missing client ID.\");\r\n          setLoading(false);\r\n          return;\r\n        }\r\n\r\n        window.google.accounts.id.initialize({\r\n          client_id: CLIENT_ID,\r\n          callback: handleCredentialResponse,\r\n          ux_mode: \"popup\",\r\n        });\r\n\r\n        setGoogleReady(true);\r\n        setLoading(false);\r\n      } else {\r\n        // If still not loaded, retry after a short delay\r\n        retryTimeout = window.setTimeout(tryInitialize, 100);\r\n      }\r\n    };\r\n\r\n    tryInitialize();\r\n    return () => {\r\n      if (retryTimeout) clearTimeout(retryTimeout);\r\n    };\r\n  }, [handleCredentialResponse]);\r\n\r\n  // 1a) If weâ€™re waiting for auth to finish, show loader\r\n  if (initializing || loading) {\r\n    return <Loader />;\r\n  }\r\n\r\n  // 2a) If already authenticated, redirect\r\n  if (!initializing && isAuthenticated) {\r\n    return <Navigate to=\"/dentgo-gpt-home\" replace />;\r\n  }\r\n\r\n  return (\r\n    <div className=\"bg-white h-screen w-full overflow-hidden flex flex-col relative\">\r\n      {/* ===== HEADER ===== */}\r\n      <div className=\"flex-none bg-primary relative\">\r\n        <header className=\"pt-6 px-4 flex items-center\">\r\n          <button onClick={() => navigate(-1)} className=\"p-0\" aria-label=\"Go Back\">\r\n            <img src={buttonBack} alt=\"Go Back\" className=\"w-6 h-auto\" />\r\n          </button>\r\n        </header>\r\n        <div className=\"flex flex-col items-center justify-center py-4\">\r\n          <img src={logo} alt=\"Dentgo logo\" className=\"w-24 h-auto object-contain\" />\r\n          <h1 className=\"text-white text-2xl font-semibold mt-3 text-center\">\r\n            DentGo AI\r\n          </h1>\r\n        </div>\r\n      </div>\r\n\r\n      {/* ===== MAIN LOGIN SECTION ===== */}\r\n      <div className=\"flex-1 w-full flex flex-col items-center justify-start px-4 pt-4 relative z-10\">\r\n        <div className=\"w-full max-w-md\">\r\n          <h2 className=\"text-center text-gray-800 text-2xl font-semibold mb-4\">\r\n            Welcome\r\n          </h2>\r\n\r\n          {error && (\r\n            <div\r\n              role=\"alert\"\r\n              className=\"bg-yellow-100 text-yellow-700 p-3 mb-4 rounded cursor-pointer\"\r\n              onClick={() => setError(null)}\r\n              onKeyDown={(e) => {\r\n                if (e.key === \"Enter\" || e.key === \" \") {\r\n                  setError(null);\r\n                }\r\n              }}\r\n              tabIndex={0}\r\n            >\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"flex flex-col gap-4 w-full\">\r\n            {/* Google One-Tap / Button */}\r\n            <button\r\n              type=\"button\"\r\n              disabled={!googleReady}\r\n              className={`\r\n                flex items-center justify-center gap-3 w-full py-3 border border-gray-300 rounded-lg \r\n                bg-white font-semibold text-base text-black transition\r\n                ${googleReady ? \"hover:bg-gray-100\" : \"opacity-50 cursor-not-allowed\"}\r\n              `}\r\n              onClick={() => {\r\n                if (window.google?.accounts?.id && googleReady) {\r\n                  try {\r\n                    window.google.accounts.id.prompt();\r\n                  } catch (err: any) {\r\n                    if (err.name !== \"AbortError\") {\r\n                      console.error(\"Google prompt error:\", err);\r\n                      setError(\"Unexpected error when opening Google login. Please try again.\");\r\n                    }\r\n                  }\r\n                } else {\r\n                  alert(\"Google login is not ready yet.\");\r\n                }\r\n              }}\r\n            >\r\n              <img src={GoogleIcon} alt=\"Google logo\" className=\"w-5 h-5\" />\r\n              <span>Continue with Google</span>\r\n            </button>\r\n\r\n            {/* Apple Login */}\r\n            <button\r\n              type=\"button\"\r\n              className=\"\r\n                flex items-center justify-center gap-3 w-full py-3 border border-gray-300 \r\n                rounded-lg bg-white font-semibold text-base text-black transition hover:bg-gray-100\r\n              \"\r\n              onClick={async () => {\r\n                try {\r\n                  // Apple login will redirect the user to Apple, then back with cookies set\r\n                  loginWithApple();\r\n                } catch (err: any) {\r\n                  console.error(\"Apple login error:\", err);\r\n                  setError(err?.message || \"Apple authentication failed. Please try again.\");\r\n                }\r\n              }}\r\n            >\r\n              <img src={AppleIcon} alt=\"Apple logo\" className=\"w-5 h-5\" />\r\n              <span>Continue with Apple</span>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* ===== FOOTER ILLUSTRATION ===== */}\r\n      <div className=\"absolute bottom-0 left-0 w-full h-1/3 overflow-hidden\">\r\n        <img\r\n          src={dentaiBottom}\r\n          alt=\"Dental AI graphic\"\r\n          className=\"w-full h-full object-cover\"\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Login;\r\n"],"names":["logo","AppleIcon","GoogleIcon","dentaiBottom","useGoogleIdentity","callback","useEffect","id","script","CLIENT_ID","Login","navigate","useNavigate","login","isAuthenticated","initializing","error","setError","useAuth","loading","setLoading","useState","googleReady","setGoogleReady","handleCredentialResponse","useCallback","response","credential","user","loginWithGoogleAPI","err","retryTimeout","tryInitialize","_b","_a","Loader","Navigate","jsxs","jsx","buttonBack","e","loginWithApple"],"mappings":"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"}