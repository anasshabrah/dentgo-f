import{j as e,u as w,r,A as P,L as k}from"./index-WC5m9pr2.js";import{S,u as E,c as A,a as I,P as C}from"./stripeClient-B0uSAGAL.js";import{f as u}from"./cards-XX6NtHTw.js";const q=()=>{const y=w(),n=E(),[a,h]=r.useState(!0),[c,d]=r.useState([]),[l,p]=r.useState(""),[i,f]=r.useState(null),[g,b]=r.useState(!1);r.useEffect(()=>{const t=setTimeout(()=>h(!1),500);return()=>clearTimeout(t)},[]),r.useEffect(()=>{a||(async()=>{try{const t=await u();d(t)}catch(t){console.error("Failed to fetch saved cards:",t),p("Unable to load saved cards.")}})()},[a]),r.useEffect(()=>{a||(async()=>{try{if(!n)return;const t=await A({country:"US",currency:"usd",total:{label:"Save Card",amount:0},requestPayerEmail:!0,requestPayerName:!0});t.on("paymentmethod",async s=>{try{const o=await I(),{error:m,setupIntent:x}=await n.confirmCardSetup(o,{payment_method:s.paymentMethod.id});if(m||!x){s.complete("fail"),console.error("SetupIntent confirmation error:",m);return}const v=x.payment_method;await fetch(`${P}/api/payments/cards`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentMethodId:v,nickName:null})}),s.complete("success");const N=await u();d(N)}catch(o){console.error("Error saving card via PaymentRequest:",o),s.complete("fail")}}),await t.canMakePayment()&&(f(t),b(!0))}catch(t){console.error("PaymentRequest init error:",t)}})()},[a,n]);const j=()=>y("/add-new-card");return a?e.jsx(k,{fullscreen:!0}):e.jsx("div",{className:"bg-gray-100 dark:bg-gray-900 min-h-screen pb-4 flex flex-col",children:e.jsx("div",{className:"mx-auto max-w-lg px-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 pt-4 px-4 mt-5 rounded-t-3xl h-[calc(100vh-90px)] overflow-y-auto flex flex-col",children:[g&&i?e.jsx("div",{className:"border-b-2 border-gray-200 dark:border-gray-700 mb-4",children:e.jsx(C,{options:{paymentRequest:i}})}):e.jsxs("div",{className:"border-b-2 border-gray-200 dark:border-gray-700 mb-4 px-2 py-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Apple Pay / Google Pay currently unavailable."}),e.jsxs("small",{className:"block text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Ensure youâ€™re on Safari (Apple Pay) or Chrome (Google Pay), using HTTPS or localhost, and that"," ",e.jsx("code",{children:"VITE_STRIPE_PUBLISHABLE_KEY"})," is set."]})]}),l&&e.jsx("div",{className:"text-sm p-2 border border-red-600 rounded text-red-600 bg-red-100 mb-4",children:l}),c.length>0?e.jsx("div",{className:"flex-1 overflow-y-auto",children:c.map(t=>e.jsx("div",{className:"border-b-2 border-gray-200 dark:border-gray-700 px-0",children:e.jsxs("div",{className:"flex items-center gap-2 py-4 pr-8",children:[e.jsx("span",{className:"border border-gray-200 dark:border-gray-700 px-5 py-2 rounded flex items-center justify-center w-12 h-8",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"20",viewBox:"0 0 32 20",fill:"none",children:[e.jsx("rect",{width:"32",height:"20",rx:"3",fill:"#E0E0E0"}),e.jsx("text",{x:"16",y:"13",textAnchor:"middle",fontSize:"10",fill:"#333",children:t.network})]})}),e.jsxs("div",{className:"pl-4",children:[e.jsx("div",{className:"text-gray-800 dark:text-gray-200 text-base font-semibold leading-6",children:t.network}),e.jsxs("div",{className:"text-gray-500 dark:text-gray-400 text-sm font-medium leading-5",children:[e.jsx("span",{className:t.isActive?"text-blue-800 dark:text-primary":"text-red-600",children:t.isActive?"Active":"Inactive"})," ","| Card Number **** ",t.last4]})]})]})},t.id))}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 my-3 text-sm",children:"No saved cards found."}),e.jsx("div",{className:"flex flex-col items-center justify-center mt-4",children:e.jsx("div",{className:"w-full bg-blue-800 dark:bg-blue-700 text-white text-lg font-medium rounded-xl py-4 my-4 flex justify-center items-center hover:bg-blue-700 dark:hover:bg-blue-600 cursor-pointer transition",onClick:j,children:"Add New Payment"})})]})})})},B=()=>e.jsx(S,{children:e.jsx(q,{})});export{B as default};
//# sourceMappingURL=PaymentMethod-B8oN5Q9B.js.map
