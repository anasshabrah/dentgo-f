import{j as e,u as S,r as l,L as E,b as A,A as b}from"./index-AnWCcf8t.js";import{c as F}from"./cards-Cy3an-VF.js";import{E as P,s as I,u as T,b as B,C as g}from"./stripeClient-DmXsUCEx.js";const _=()=>{const i=S(),c=T(),m=B(),[h,y]=l.useState(!0),[d,N]=l.useState(""),[u,t]=l.useState(""),[p,a]=l.useState(!1);l.useEffect(()=>{const r=setTimeout(()=>y(!1),500);return()=>clearTimeout(r)},[]);const j=()=>i(-1),v=r=>N(r.target.value),w=async r=>{var x;r.preventDefault(),t(""),a(!0);try{if(await fetch(`${b}/api/payments/create-customer`,{method:"POST",credentials:"include"}),!c||!m){t("Stripe has not fully loaded. Please try again."),a(!1);return}const s=m.getElement(g);if(!s){t("Card element not found."),a(!1);return}const o=await fetch(`${b}/api/payments/create-setup-intent`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});if(!o.ok){const C=await o.json();throw new Error(C.error||"Failed to create SetupIntent on server.")}const{clientSecret:k}=await o.json(),n=await c.confirmCardSetup(k,{payment_method:{card:s,billing_details:{name:d}}});if(n.error||!n.setupIntent){t(((x=n.error)==null?void 0:x.message)||"Failed to confirm SetupIntent."),a(!1);return}const f=n.setupIntent.payment_method;if(!f){t("No PaymentMethod returned from Stripe."),a(!1);return}await F({paymentMethodId:f,nickName:d||null}),i("/payment-method")}catch(s){console.error("AddNewCard error:",s),t(s.message||"Failed to save card."),a(!1)}};return h?e.jsx(E,{}):e.jsx("div",{className:"bg-white dark:bg-gray-900 min-h-screen pb-4",children:e.jsx("div",{className:"bg-blue-800 pt-4 pb-8",children:e.jsxs("div",{className:"mx-auto max-w-lg px-4",children:[e.jsxs("div",{className:"pt-2 flex items-center px-3",children:[e.jsx("button",{onClick:j,className:"mr-3 p-0","aria-label":"Go back",children:e.jsx("img",{className:"inline-block w-6 h-auto",src:A,alt:"Go back"})}),e.jsx("h1",{className:"text-white text-lg font-medium",children:"Add New Card"})]}),e.jsxs("form",{className:"bg-blue-800 pt-4 px-4 flex flex-col items-stretch mt-5 rounded-t-3xl h-[calc(100vh-90px)] overflow-y-auto",onSubmit:w,children:[e.jsxs("div",{className:"relative mb-3",children:[e.jsx("input",{type:"text",id:"cardName",autoComplete:"off",required:!0,value:d,onChange:v,placeholder:" ",className:"peer w-full border border-gray-200 dark:border-gray-700 rounded px-2 py-3 text-base font-medium text-gray-800 dark:text-gray-200 bg-white dark:bg-gray-800"}),e.jsx("label",{htmlFor:"cardName",className:"absolute top-1/2 left-3 -translate-y-1/2 text-sm text-gray-500 dark:text-gray-400 transition-all peer-focus:-top-2 peer-focus:left-2 peer-focus:text-xs peer-focus:text-gray-800 dark:peer-focus:text-gray-200 peer-valid:-top-2 peer-valid:left-2 peer-valid:text-xs peer-valid:text-gray-800 dark:peer-valid:text-gray-200 bg-white dark:bg-gray-800 px-1",children:"Card Name"})]}),e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"w-full h-16 bg-gray-100 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl px-4 pt-5 text-lg text-gray-800 dark:text-gray-200",children:e.jsx(g,{id:"card-element",options:{style:{base:{fontSize:"18px",color:"#374151",fontFamily:"'Satoshi', sans-serif","::placeholder":{color:"#6B7280"}},invalid:{color:"#FF484D"}},hidePostalCode:!0}})})}),u&&e.jsx("div",{className:"text-sm p-2 border border-red-600 rounded bg-red-100 mb-3 text-red-600",role:"alert","aria-live":"assertive",children:u}),e.jsx("div",{className:"flex flex-col items-center justify-center",children:e.jsx("button",{type:"submit",className:"fixed bottom-5 left-1/2 transform -translate-x-1/2 w-full max-w-sm bg-blue-100 dark:bg-gray-700 text-blue text-lg font-medium rounded-xl py-4 text-center disabled:opacity-50",disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"border-2 border-[rgba(255,255,255,0.3)] border-t-white rounded-full w-4 h-4 animate-spin inline-block mr-2 align-middle","aria-hidden":"true"}),"Addingâ€¦"]}):"Add My Card"})})]})]})})})},G=()=>e.jsx(P,{stripe:I,children:e.jsx(_,{})});export{G as default};
//# sourceMappingURL=AddNewCard-DgYihbK3.js.map
