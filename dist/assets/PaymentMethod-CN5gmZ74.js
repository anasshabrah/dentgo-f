import{j as e,u as P,r as s,A as S,L as E,b as k}from"./index-AnWCcf8t.js";import{f as h}from"./cards-Cy3an-VF.js";import{S as A,u as C,c as I,a as M,P as q}from"./stripeClient-DmXsUCEx.js";const B=()=>{const o=P(),n=C(),[a,p]=s.useState(!0),[l,i]=s.useState([]),[d,y]=s.useState(""),[m,f]=s.useState(null),[b,g]=s.useState(!1);s.useEffect(()=>{const t=setTimeout(()=>p(!1),500);return()=>clearTimeout(t)},[]),s.useEffect(()=>{a||(async()=>{try{const t=await h();i(t)}catch(t){console.error("Failed to fetch saved cards:",t),y("Unable to load saved cards.")}})()},[a]),s.useEffect(()=>{a||(async()=>{try{if(!n)return;const t=await I({country:"US",currency:"usd",total:{label:"Save Card",amount:0},requestPayerEmail:!0,requestPayerName:!0});t.on("paymentmethod",async r=>{try{const c=await M(),{error:u,setupIntent:x}=await n.confirmCardSetup(c,{payment_method:r.paymentMethod.id});if(u||!x){r.complete("fail"),console.error("SetupIntent confirmation error:",u);return}const v=x.payment_method;await fetch(`${S}/api/payments/cards`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentMethodId:v,nickName:null})}),r.complete("success");const w=await h();i(w)}catch(c){console.error("Error saving card via PaymentRequest:",c),r.complete("fail")}}),await t.canMakePayment()&&(f(t),g(!0))}catch(t){console.error("PaymentRequest init error:",t)}})()},[a,n]);const j=()=>o(-1),N=()=>o("/add-new-card");return a?e.jsx(E,{}):e.jsx("div",{className:"bg-gray-100 min-h-screen pb-4 flex flex-col",children:e.jsx("div",{className:"bg-blue-800 pt-4 pb-8",children:e.jsxs("div",{className:"mx-auto max-w-lg px-4",children:[e.jsxs("header",{className:"pt-8 flex items-center px-3",children:[e.jsx("button",{onClick:j,className:"mr-3 p-0","aria-label":"Go back",children:e.jsx("img",{className:"inline-block w-8 h-auto",src:k,alt:"Go Back"})}),e.jsx("h1",{className:"m-0 text-white text-lg font-medium",children:"Payment Method"})]}),e.jsxs("div",{className:"bg-white pt-4 px-4 flex flex-col items-stretch mt-5 rounded-t-3xl h-[calc(100vh-90px)] overflow-y-auto",children:[b&&m?e.jsx("div",{className:"border-b-2 border-gray-200",children:e.jsx(q,{options:{paymentRequest:m}})}):e.jsxs("div",{className:"border-b-2 border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-500 my-4",children:"Apple Pay / Google Pay currently unavailable"}),e.jsxs("small",{className:"block text-xs text-gray-500 mb-4",children:["Make sure youâ€™re on a supported browser (Safari for Apple Pay, Chrome for Google Pay), using HTTPS or localhost, and that"," ",e.jsx("code",{children:"VITE_STRIPE_PUBLISHABLE_KEY"})," is set."]})]}),d&&e.jsx("div",{className:"text-sm p-2 border border-red-600 rounded text-red-600 bg-red-100 mb-3",children:d}),l.length>0?l.map(t=>e.jsx("div",{className:"border-b-2 border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-2 py-4 pr-8 cursor-pointer",children:[e.jsx("span",{className:"border border-gray-200 px-5 py-2 rounded flex items-center justify-center w-12 h-8",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"20",viewBox:"0 0 32 20",fill:"none",children:[e.jsx("rect",{width:"32",height:"20",rx:"3",fill:"#E0E0E0"}),e.jsx("text",{x:"16",y:"13",textAnchor:"middle",fontSize:"10",fill:"#333",children:t.network})]})}),e.jsxs("div",{className:"pl-4",children:[e.jsx("div",{className:"text-gray-800 text-base font-semibold leading-6",children:t.network}),e.jsxs("div",{className:"text-gray-500 text-sm font-medium leading-5",children:[e.jsx("span",{className:t.isActive?"text-blue-800":"text-red",children:t.isActive?"Active":"Inactive"})," ","| Card Number **** ",t.last4]})]})]})},t.id)):e.jsx("p",{className:"text-gray-500 my-3 text-sm",children:"No saved cards found."}),e.jsx("div",{className:"flex flex-col items-center justify-center",children:e.jsx("div",{className:"w-full bg-blue-800 text-white text-lg font-medium rounded-xl py-4 my-4 flex justify-center items-center transition hover:bg-blue-700 cursor-pointer",onClick:N,children:"Add New Payment"})})]})]})})})},L=()=>e.jsx(A,{children:e.jsx(B,{})});export{L as default};
//# sourceMappingURL=PaymentMethod-CN5gmZ74.js.map
