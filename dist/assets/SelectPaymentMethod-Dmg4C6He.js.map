{"version":3,"file":"SelectPaymentMethod-Dmg4C6He.js","sources":["../../src/pages/SelectPaymentMethod.tsx"],"sourcesContent":["// src/pages/SelectPaymentMethod.tsx\r\n\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useNavigate, Link } from \"react-router-dom\";\r\nimport Loader from \"@components/ui/Loader\";\r\nimport { StripeElements } from \"../lib/stripeClient\";\r\nimport {\r\n  createPaymentRequest,\r\n  createPaymentIntent,\r\n  PaymentRequestButtonElement,\r\n  useStripe,\r\n} from \"../lib/stripeClient\";\r\nimport { fetchCards } from \"../api/cards\";\r\nimport type { PaymentRequest as StripePaymentRequest } from \"@stripe/stripe-js\";\r\n\r\ninterface Card {\r\n  id: number;\r\n  network: string | null;\r\n  last4: string;\r\n  isActive: boolean;\r\n}\r\n\r\nconst InnerSelectPaymentMethod: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const stripe = useStripe();\r\n  const [loading, setLoading] = useState<boolean>(true);\r\n  const [cards, setCards] = useState<Card[]>([]);\r\n  const [fetchError, setFetchError] = useState<string>(\"\");\r\n  const [paymentRequest, setPaymentRequest] = useState<StripePaymentRequest | null>(null);\r\n\r\n  // Simulate initial loading delay\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => setLoading(false), 500);\r\n    return () => clearTimeout(timer);\r\n  }, []);\r\n\r\n  // Initialize PaymentRequest for Apple/Google Pay\r\n  useEffect(() => {\r\n    if (loading || !stripe) return;\r\n\r\n    (async () => {\r\n      try {\r\n        const pr = await createPaymentRequest({\r\n          country: \"US\",\r\n          currency: \"usd\",\r\n          total: { label: \"Your Order\", amount: 5000 },\r\n          requestPayerName: true,\r\n          requestPayerEmail: true,\r\n        });\r\n\r\n        // Check if user can make payment\r\n        if (await pr.canMakePayment()) {\r\n          setPaymentRequest(pr);\r\n        }\r\n\r\n        pr.on(\"paymentmethod\", async (event: any) => {\r\n          try {\r\n            const clientSecret = await createPaymentIntent(5000);\r\n            const { error, paymentIntent } = await stripe.confirmCardPayment(\r\n              clientSecret,\r\n              { payment_method: event.paymentMethod.id }\r\n            );\r\n            if (error || !paymentIntent) {\r\n              event.complete(\"fail\");\r\n              console.error(\"PaymentIntent confirmation error:\", error);\r\n              return;\r\n            }\r\n            event.complete(\"success\");\r\n            navigate(\"/confirm-payment-pin\");\r\n          } catch (err) {\r\n            console.error(\"Error during PaymentRequest flow:\", err);\r\n            event.complete(\"fail\");\r\n          }\r\n        });\r\n      } catch (err) {\r\n        console.error(\"PaymentRequest init error:\", err);\r\n      }\r\n    })();\r\n  }, [loading, stripe, navigate]);\r\n\r\n  // Fetch saved cards once loading completes\r\n  useEffect(() => {\r\n    if (loading) return;\r\n    (async () => {\r\n      try {\r\n        const data = await fetchCards();\r\n        setCards(data);\r\n      } catch (err) {\r\n        console.error(\"Failed to fetch saved cards:\", err);\r\n        setFetchError(\"Unable to load saved cards.\");\r\n      }\r\n    })();\r\n  }, [loading]);\r\n\r\n  const handleContinue = () => {\r\n    navigate(\"/confirm-payment-pin\");\r\n  };\r\n\r\n  if (loading) {\r\n    return <Loader fullscreen />;\r\n  }\r\n\r\n  return (\r\n    <div className=\"bg-gray-100 dark:bg-gray-900 min-h-screen pb-4 flex flex-col\">\r\n      <div className=\"mx-auto max-w-[480px] px-4\">\r\n        <div className=\"bg-white dark:bg-gray-800 pt-4 px-4 mt-5 rounded-t-3xl h-[calc(100vh-90px)] overflow-y-auto flex flex-col\">\r\n          {/* Payment Request Button (Apple/Google Pay) */}\r\n          {paymentRequest ? (\r\n            <div className=\"mb-4\">\r\n              <PaymentRequestButtonElement options={{ paymentRequest }} />\r\n            </div>\r\n          ) : (\r\n            <div className=\"border-b-2 border-gray-200 dark:border-gray-700 mb-4 px-2 py-4\">\r\n              <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                Apple Pay / Google Pay currently unavailable.\r\n              </p>\r\n              <small className=\"block text-xs text-gray-500 dark:text-gray-400 mt-1\">\r\n                Ensure youâ€™re on Safari (Apple Pay) or Chrome (Google Pay), using HTTPS or localhost.\r\n              </small>\r\n            </div>\r\n          )}\r\n\r\n          {/* Error Banner */}\r\n          {fetchError && (\r\n            <div className=\"text-sm p-2 border border-red-600 rounded text-red-600 bg-red-100 mb-3\">\r\n              {fetchError}\r\n            </div>\r\n          )}\r\n\r\n          {/* Saved Cards List */}\r\n          {cards.length > 0 ? (\r\n            <div className=\"flex-1 overflow-y-auto\">\r\n              {cards.map((card) => (\r\n                <div\r\n                  key={card.id}\r\n                  className=\"border-b-2 border-gray-200 dark:border-gray-700 px-0\"\r\n                >\r\n                  <div className=\"flex items-center gap-2 py-4 pr-8 transition-colors hover:bg-gray-50 dark:hover:bg-gray-700\">\r\n                    <span className=\"flex items-center justify-center w-12 h-8 border border-gray-200 dark:border-gray-700 rounded\">\r\n                      <svg\r\n                        xmlns=\"http://www.w3.org/2000/svg\"\r\n                        width=\"32\"\r\n                        height=\"20\"\r\n                        viewBox=\"0 0 32 20\"\r\n                        fill=\"none\"\r\n                      >\r\n                        <rect width=\"32\" height=\"20\" rx=\"3\" fill=\"#E0E0E0\" />\r\n                        <text\r\n                          x=\"16\"\r\n                          y=\"13\"\r\n                          textAnchor=\"middle\"\r\n                          fontSize=\"10\"\r\n                          fill=\"#333\"\r\n                        >\r\n                          {card.network}\r\n                        </text>\r\n                      </svg>\r\n                    </span>\r\n                    <div className=\"pl-4\">\r\n                      <div className=\"text-gray-800 dark:text-gray-200 text-base font-bold leading-6\">\r\n                        {card.network}\r\n                      </div>\r\n                      <div className=\"text-gray-500 dark:text-gray-400 text-sm font-medium leading-5\">\r\n                        <span\r\n                          className={\r\n                            card.isActive\r\n                              ? \"text-blue-800 dark:text-primary\"\r\n                              : \"text-red-600\"\r\n                          }\r\n                        >\r\n                          {card.isActive ? \"Active\" : \"Inactive\"}\r\n                        </span>{\" \"}\r\n                        | Card Number **** {card.last4}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          ) : (\r\n            <p className=\"text-gray-500 dark:text-gray-400 my-3 text-sm\">\r\n              No saved cards found.\r\n            </p>\r\n          )}\r\n\r\n          {/* Link a New Card */}\r\n          <div className=\"mb-4\">\r\n            <Link to=\"/add-new-card\" className=\"text-blue-600 dark:text-primary text-base font-medium\">\r\n              + Link a New Card\r\n            </Link>\r\n          </div>\r\n\r\n          {/* Continue Button */}\r\n          <div className=\"flex items-center justify-center flex-col mt-auto mb-4\">\r\n            <div\r\n              className=\"w-full py-4 bg-white dark:bg-gray-700 text-blue-600 dark:text-primary text-lg font-medium rounded-xl text-center cursor-pointer hover:bg-blue-50 dark:hover:bg-gray-600 transition\"\r\n              onClick={handleContinue}\r\n            >\r\n              Continue\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst SelectPaymentMethod: React.FC = () => (\r\n  <StripeElements>\r\n    <InnerSelectPaymentMethod />\r\n  </StripeElements>\r\n);\r\n\r\nexport default SelectPaymentMethod;\r\n"],"names":["InnerSelectPaymentMethod","navigate","useNavigate","stripe","useStripe","loading","setLoading","useState","cards","setCards","fetchError","setFetchError","paymentRequest","setPaymentRequest","useEffect","timer","pr","createPaymentRequest","event","clientSecret","createPaymentIntent","error","paymentIntent","err","data","fetchCards","handleContinue","jsx","Loader","jsxs","PaymentRequestButtonElement","card","Link","SelectPaymentMethod","StripeElements"],"mappings":"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"}