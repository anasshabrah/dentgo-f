import{j as e,u as C,r as d,L as k,A as f}from"./index-WC5m9pr2.js";import{c as E}from"./cards-XX6NtHTw.js";import{E as F,s as A,u as P,b as I,C as g}from"./stripeClient-B0uSAGAL.js";const T=()=>{const b=C(),i=P(),c=I(),[h,y]=d.useState(!0),[o,v]=d.useState(""),[m,t]=d.useState(""),[u,r]=d.useState(!1);d.useEffect(()=>{const a=setTimeout(()=>y(!1),500);return()=>clearTimeout(a)},[]);const N=a=>v(a.target.value),j=async a=>{var p;a.preventDefault(),t(""),r(!0);try{if(await fetch(`${f}/api/payments/create-customer`,{method:"POST",credentials:"include"}),!i||!c){t("Stripe has not fully loaded. Please try again."),r(!1);return}const s=c.getElement(g);if(!s){t("Card element not found."),r(!1);return}const l=await fetch(`${f}/api/payments/create-setup-intent`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});if(!l.ok){const S=await l.json();throw new Error(S.error||"Failed to create SetupIntent on server.")}const{clientSecret:w}=await l.json(),n=await i.confirmCardSetup(w,{payment_method:{card:s,billing_details:{name:o}}});if(n.error||!n.setupIntent){t(((p=n.error)==null?void 0:p.message)||"Failed to confirm SetupIntent."),r(!1);return}const x=n.setupIntent.payment_method;if(!x){t("No PaymentMethod returned from Stripe."),r(!1);return}await E({paymentMethodId:x,nickName:o||null}),b("/payment-method")}catch(s){console.error("AddNewCard error:",s),t(s.message||"Failed to save card."),r(!1)}};return h?e.jsx(k,{}):e.jsx("div",{className:"bg-white dark:bg-gray-900 min-h-screen pb-4",children:e.jsx("div",{className:"mx-auto max-w-lg px-4",children:e.jsxs("form",{className:"bg-blue-800 pt-4 px-4 flex flex-col items-stretch mt-5 rounded-t-3xl h-[calc(100vh-90px)] overflow-y-auto",onSubmit:j,children:[e.jsxs("div",{className:"relative mb-3",children:[e.jsx("input",{type:"text",id:"cardName",autoComplete:"off",required:!0,value:o,onChange:N,placeholder:" ",className:"peer w-full border border-gray-200 dark:border-gray-700 rounded px-2 py-3 text-base font-medium text-gray-800 dark:text-gray-200 bg-white dark:bg-gray-800"}),e.jsx("label",{htmlFor:"cardName",className:"absolute top-1/2 left-3 -translate-y-1/2 text-sm text-gray-500 dark:text-gray-400 transition-all peer-focus:-top-2 peer-focus:left-2 peer-focus:text-xs peer-focus:text-gray-800 dark:peer-focus:text-gray-200 peer-valid:-top-2 peer-valid:left-2 peer-valid:text-xs peer-valid:text-gray-800 dark:peer-valid:text-gray-200 bg-white dark:bg-gray-800 px-1",children:"Card Name"})]}),e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"w-full h-16 bg-gray-100 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl px-4 pt-5 text-lg text-gray-800 dark:text-gray-200",children:e.jsx(g,{id:"card-element",options:{style:{base:{fontSize:"18px",color:"#374151",fontFamily:"'Satoshi', sans-serif","::placeholder":{color:"#6B7280"}},invalid:{color:"#FF484D"}},hidePostalCode:!0}})})}),m&&e.jsx("div",{className:"text-sm p-2 border border-red-600 rounded bg-red-100 mb-3 text-red-600",role:"alert","aria-live":"assertive",children:m}),e.jsx("div",{className:"flex flex-col items-center justify-center",children:e.jsx("button",{type:"submit",className:"fixed bottom-5 left-1/2 transform -translate-x-1/2 w-full max-w-sm bg-blue-100 dark:bg-gray-700 text-blue text-lg font-medium rounded-xl py-4 text-center disabled:opacity-50",disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"border-2 border-[rgba(255,255,255,0.3)] border-t-white rounded-full w-4 h-4 animate-spin inline-block mr-2 align-middle","aria-hidden":"true"}),"Addingâ€¦"]}):"Add My Card"})})]})})})},B=()=>e.jsx(F,{stripe:A,children:e.jsx(T,{})});export{B as default};
//# sourceMappingURL=AddNewCard-2I31SdEo.js.map
