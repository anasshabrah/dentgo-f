{"version":3,"file":"SubscriptionPayment-vzFpCw24.js","sources":["../../src/pages/SubscriptionPayment.tsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport buttonBack from \"../assets/images/Button-Back.png\";\r\nimport logo from \"../assets/images/logo.png\";\r\nimport Loader from \"../components/ui/Loader\";\r\nimport {\r\n  Elements as ElementsWrapper,\r\n  useStripe,\r\n  PaymentRequestButtonElement,\r\n} from \"@stripe/react-stripe-js\";\r\nimport {\r\n  stripePromise,\r\n  createPaymentRequest,\r\n  createSubscriptionIntent,\r\n} from \"../lib/stripeClient\";\r\nimport { API_BASE } from \"../config\";\r\n\r\nconst PaymentRequestSection = () => {\r\n  const stripe = useStripe();\r\n  const navigate = useNavigate();\r\n  const [paymentRequest, setPaymentRequest] = useState<PaymentRequest | null>(\r\n    null\r\n  );\r\n\r\n  // 1) build PaymentRequest\r\n  useEffect(() => {\r\n    if (!stripe) return;\r\n    (async () => {\r\n      try {\r\n        const pr = await createPaymentRequest({\r\n          country: \"US\",\r\n          currency: \"usd\",\r\n          total: {\r\n            label: \"DentGo Plus Subscription\",\r\n            amount: 2500, // $25.00 in cents\r\n          },\r\n          requestPayerName: true,\r\n          requestPayerEmail: true,\r\n        });\r\n\r\n        pr.on(\"paymentmethod\", async (event: any) => {\r\n          // 2) when user taps Apple/Google Pay, attach that paymentMethod to a Subscription\r\n          try {\r\n            // create a new Subscription on the backend\r\n            const priceId = import.meta.env.VITE_STRIPE_PRICE_ID || \"\";\r\n            const paymentMethodId = event.paymentMethod.id as string;\r\n\r\n            // ask backend to create subscription Intent\r\n            const { clientSecret } = await createSubscriptionIntent(\r\n              priceId,\r\n              paymentMethodId\r\n            );\r\n\r\n            // confirm via Stripe\r\n            const { error, paymentIntent } = await stripe.confirmCardPayment(\r\n              clientSecret,\r\n              { payment_method: paymentMethodId }\r\n            );\r\n            if (error || !paymentIntent) {\r\n              event.complete(\"fail\");\r\n              console.error(\"Subscription payment error:\", error);\r\n              return;\r\n            }\r\n\r\n            event.complete(\"success\");\r\n            // redirect to PIN / confirmation flow\r\n            navigate(\"/confirm-payment-pin\");\r\n          } catch (err) {\r\n            console.error(\"Error creating subscription:\", err);\r\n            event.complete(\"fail\");\r\n          }\r\n        });\r\n\r\n        pr.canMakePayment().then((result: any) => {\r\n          if (result) setPaymentRequest(pr);\r\n        });\r\n      } catch (err) {\r\n        console.error(\"PaymentRequest init error:\", err);\r\n      }\r\n    })();\r\n  }, [stripe, navigate]);\r\n\r\n  if (!paymentRequest) return null;\r\n\r\n  return (\r\n    <div className=\"w-full mb-4\">\r\n      <PaymentRequestButtonElement\r\n        options={{\r\n          paymentRequest,\r\n          style: {\r\n            paymentRequestButton: {\r\n              type: \"buy\",\r\n              theme: \"dark\",\r\n              height: \"48px\",\r\n            },\r\n          },\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nconst SubscriptionPayment = () => {\r\n  const navigate = useNavigate();\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const handleBackClick = () => {\r\n    navigate(-1);\r\n  };\r\n\r\n  const handleProceedToCheckout = () => {\r\n    // as a fallback, navigate to confirm-pin (in case user wants to pick a saved card)\r\n    navigate(\"/confirm-payment-pin\");\r\n  };\r\n\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => setLoading(false), 500);\r\n    return () => clearTimeout(timer);\r\n  }, []);\r\n\r\n  if (loading) {\r\n    return <Loader />;\r\n  }\r\n\r\n  return (\r\n    <div className=\"bg-gray-100 min-h-screen pb-4 flex flex-col\">\r\n      <ElementsWrapper stripe={stripePromise}>\r\n        <div className=\"bg-blue-800 pt-4 pb-8\">\r\n          <div className=\"mx-auto max-w-lg px-4\">\r\n            <div className=\"flex items-center space-x-3 px-3 py-2\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={handleBackClick}\r\n                className=\"p-0\"\r\n                aria-label=\"Go Back\"\r\n              >\r\n                <img className=\"w-6 h-6\" src={buttonBack} alt=\"Go Back\" />\r\n              </button>\r\n              <h1 className=\"text-white text-lg font-medium\">\r\n                DentGo Plus Subscription\r\n              </h1>\r\n            </div>\r\n            <div className=\"bg-white pt-4 px-4 flex flex-col items-stretch mt-5 rounded-t-3xl flex-1 overflow-y-auto\">\r\n              <div className=\"flex justify-center mb-4\">\r\n                <img className=\"w-24 h-auto\" src={logo} alt=\"logo\" />\r\n              </div>\r\n              <h2 className=\"text-center text-xl font-semibold text-gray-800 leading-7 mb-2\">\r\n                DentGo Plus Subscription\r\n              </h2>\r\n              <p className=\"text-center text-sm text-gray-500 mb-4\">\r\n                Subscription Due at 15 Dec 2024\r\n              </p>\r\n              <h2 className=\"text-center text-5xl font-medium text-gray-800 leading-none mb-4\">\r\n                $25.00\r\n              </h2>\r\n              <p className=\"text-center text-sm text-gray-500 mb-4\">\r\n                Choose a card or bank for payout\r\n              </p>\r\n\r\n              <PaymentRequestSection />\r\n\r\n              <p className=\"text-center text-sm text-gray-500 mb-4\">\r\n                Or select a saved payment method\r\n              </p>\r\n              <div className=\"flex items-center justify-between w-full mb-4\">\r\n                <div className=\"flex w-full items-center gap-2\">\r\n                  <span className=\"border border-gray-200 p-2 rounded w-12 h-8 flex items-center justify-center\">\r\n                    <svg\r\n                      width=\"31\"\r\n                      height=\"19\"\r\n                      viewBox=\"0 0 31 19\"\r\n                      fill=\"none\"\r\n                      xmlns=\"http://www.w3.org/2000/svg\"\r\n                    >\r\n                      <path\r\n                        fillRule=\"evenodd\"\r\n                        clipRule=\"evenodd\"\r\n                        d=\"M28.2291 29.1046C27.2289 28.1044 26.667 26.7478 26.667 25.3333C26.667 23.9188 27.2289 22.5623 28.2291 21.5621C29.2293 20.5619 30.5858 20 32.0003 20C33.4148 20 34.7714 20.5619 35.7716 21.5621C36.7718 22.5623 37.3337 23.9188 37.3337 25.3333C37.3337 26.7478 36.7718 28.1044 35.7716 29.1046C34.7714 30.1048 33.4148 30.6667 32.0003 30.6667C30.5858 30.6667 29.2293 30.1048 28.2291 29.1046Z\"\r\n                        fill=\"#ED0006\"\r\n                      />\r\n                      <path\r\n                        fillRule=\"evenodd\"\r\n                        clipRule=\"evenodd\"\r\n                        d=\"M15.0957 16.4389C17.0557 14.8004 18.2985 12.3624 18.2985 9.63996C18.2985 6.91754 17.0557 4.47955 15.0957 2.84102C16.6878 1.51009 18.753 0.706627 21.0098 0.706627C26.0449 0.706627 30.1267 4.70622 30.1267 9.63996C30.1267 14.5737 26.0449 18.5733 21.0098 18.5733C18.753 18.5733 16.6878 17.7698 15.0957 16.4389Z\"\r\n                        fill=\"#F9A000\"\r\n                      />\r\n                    </svg>\r\n                  </span>\r\n                  <div className=\"pl-4\">\r\n                    <div className=\"text-gray-800 text-base font-semibold leading-6\">\r\n                      Master Card\r\n                    </div>\r\n                    <div className=\"text-gray-500 text-sm font-medium leading-5\">\r\n                      Card Number **** 7887\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <button\r\n                  onClick={() => navigate(\"/select-payment-method\")}\r\n                  className=\"text-gray-800 text-2xl\"\r\n                  aria-label=\"Choose saved payment method\"\r\n                >\r\n                  <i className=\"ri-arrow-down-s-line\"></i>\r\n                </button>\r\n              </div>\r\n\r\n              <div className=\"mb-4\">\r\n                <p className=\"text-sm text-gray-500 mb-2\">Promo Code</p>\r\n                <div>\r\n                  <div className=\"relative mb-4\">\r\n                    <input\r\n                      type=\"number\"\r\n                      id=\"promo_code\"\r\n                      className=\"w-full h-16 bg-gray-200 border-2 border-gray-200 rounded-xl px-4 pt-4 text-lg text-gray-800 focus:border-blue outline-none\"\r\n                      autoComplete=\"off\"\r\n                      required\r\n                    />\r\n                    <label\r\n                      htmlFor=\"promo_code\"\r\n                      className=\"absolute left-4 top-1/2 -translate-y-1/2 text-base text-gray-500 transition-all\"\r\n                    >\r\n                      Enter Code Here\r\n                    </label>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"mt-auto\"></div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"px-4 fixed bottom-4 inset-x-0\">\r\n          <button\r\n            type=\"button\"\r\n            className=\"w-full bg-blue-800 text-white text-lg font-medium py-4 rounded\"\r\n            onClick={handleProceedToCheckout}\r\n          >\r\n            Proceed to Checkout\r\n          </button>\r\n        </div>\r\n      </ElementsWrapper>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SubscriptionPayment;\r\n"],"names":["PaymentRequestSection","stripe","useStripe","navigate","useNavigate","paymentRequest","setPaymentRequest","useState","useEffect","pr","createPaymentRequest","event","priceId","paymentMethodId","clientSecret","createSubscriptionIntent","error","paymentIntent","err","result","jsx","PaymentRequestButtonElement","SubscriptionPayment","loading","setLoading","handleBackClick","handleProceedToCheckout","timer","Loader","jsxs","ElementsWrapper","stripePromise","buttonBack","logo"],"mappings":"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"}