import{j as e,u as f,r,L as g}from"./index-WC5m9pr2.js";import{S as b,u as j,c as v,e as w,P as N}from"./stripeClient-B0uSAGAL.js";import{f as S}from"./cards-XX6NtHTw.js";const P=()=>{const i=f(),o=j(),[s,x]=r.useState(!0),[c,u]=r.useState([]),[l,y]=r.useState(""),[d,p]=r.useState(null);return r.useEffect(()=>{const t=setTimeout(()=>x(!1),500);return()=>clearTimeout(t)},[]),r.useEffect(()=>{s||!o||(async()=>{try{const t=await v({country:"US",currency:"usd",total:{label:"Subscription",amount:1e3},requestPayerName:!0,requestPayerEmail:!0});await t.canMakePayment()&&p(t),t.on("paymentmethod",async a=>{try{const{clientSecret:n,subscriptionId:k,status:E}=await w(a.paymentMethod.id,"1000"),{error:m,paymentIntent:h}=await o.confirmCardPayment(n,{payment_method:a.paymentMethod.id});if(m||!h){a.complete("fail"),console.error("Subscription confirmation error:",m);return}a.complete("success"),i("/subscription-success")}catch(n){console.error("Error during PaymentRequest flow:",n),a.complete("fail")}})}catch(t){console.error("PaymentRequest init error:",t)}})()},[s,o,i]),r.useEffect(()=>{s||(async()=>{try{const t=await S();u(t)}catch(t){console.error("Failed to fetch saved cards:",t),y("Unable to load saved cards.")}})()},[s]),s?e.jsx(g,{fullscreen:!0}):e.jsx("div",{className:"bg-gray-100 dark:bg-gray-900 min-h-screen pb-4 flex flex-col",children:e.jsx("div",{className:"mx-auto max-w-[480px] px-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 pt-4 px-4 mt-5 rounded-t-3xl h-[calc(100vh-90px)] overflow-y-auto flex flex-col",children:[d?e.jsx("div",{className:"mb-4",children:e.jsx(N,{options:{paymentRequest:d}})}):e.jsx("div",{className:"border-b-2 border-gray-200 dark:border-gray-700 mb-4 px-2 py-4",children:e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Apple Pay / Google Pay not available. Use HTTPS or localhost and supported browser."})}),l&&e.jsx("div",{className:"text-sm p-2 border border-red-600 rounded text-red-600 bg-red-100 mb-3",children:l}),c.length>0?e.jsx("div",{className:"flex-1 overflow-y-auto",children:c.map(t=>e.jsx("div",{className:"border-b-2 border-gray-200 dark:border-gray-700 px-0",children:e.jsxs("div",{className:"flex items-center gap-2 py-4 pr-8 transition-colors hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("span",{className:"flex items-center justify-center w-12 h-8 border border-gray-200 dark:border-gray-700 rounded",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"20",viewBox:"0 0 32 20",fill:"none",children:[e.jsx("rect",{width:"32",height:"20",rx:"3",fill:"#E0E0E0"}),e.jsx("text",{x:"16",y:"13",textAnchor:"middle",fontSize:"10",fill:"#333",children:t.network})]})}),e.jsxs("div",{className:"pl-4",children:[e.jsx("div",{className:"text-gray-800 dark:text-gray-200 text-base font-bold leading-6",children:t.network}),e.jsxs("div",{className:"text-gray-500 dark:text-gray-400 text-sm font-medium leading-5",children:[e.jsx("span",{className:t.isActive?"text-blue-800 dark:text-primary":"text-red-600",children:t.isActive?"Active":"Inactive"})," ","| Card Number **** ",t.last4]})]})]})},t.id))}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 my-3 text-sm",children:"No saved cards found."})]})})})},C=()=>e.jsx(b,{children:e.jsx(P,{})});export{C as default};
//# sourceMappingURL=SubscriptionPayment-GulXZX2h.js.map
